---
title: "À l’aide d’Azure AD pour l’authentification du serveur SharePoint"
ms.author: tracyp
author: MSFTTracyP
ms.reviewer:
- kirke
- josephd
- kirks
manager: laurawi
ms.date: 3/2/2018
ms.audience: ITPro
ms.topic: article
ms.service: o365-solutions
localization_priority: Normal
ms.collection:
- Ent_O365
- Ent_O365_Hybrid
ms.custom: Ent_Solutions
ms.assetid: 
description: "Résumé : Apprenez à contourner Azure Access Control Service et SAML 1.1 permet d’authentifier les utilisateurs de SharePoint Server avec Azure Active Directory."
ms.openlocfilehash: e346a79fae32c19e14ce852257d5643041faf5d4
ms.sourcegitcommit: b1cb876c8a8fca1c2d67b2bc8282f1361066962c
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/05/2018
---
# <a name="using-azure-ad-for-sharepoint-server-authentication"></a><span data-ttu-id="c55fd-103">À l’aide d’Azure AD pour l’authentification du serveur SharePoint</span><span class="sxs-lookup"><span data-stu-id="c55fd-103">Using Azure AD for SharePoint Server Authentication</span></span>

 <span data-ttu-id="c55fd-104">**Résumé :** Apprenez à authentifier les utilisateurs de SharePoint Server 2016 avec Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c55fd-104">**Summary:** Learn how to authenticate your SharePoint Server 2016 users with Azure Active Directory.</span></span>
  
> [!NOTE]
> <span data-ttu-id="c55fd-105">Cet article est basé sur le travail de Kirk Evans, responsable de programme Principal de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c55fd-105">This article is based on the work of Kirk Evans, a Microsoft Principal Program Manager.</span></span> 

<blockquote>
<p><span data-ttu-id="c55fd-p101">Cet article fait référence aux exemples de code permettant d’interagir avec Azure Active Directory graphique. Vous pouvez télécharger les exemples de code [ici](https://1drv.ms/u/s!AuAlJmH2xI6Kg3ItzF78krMFxJu3).</span><span class="sxs-lookup"><span data-stu-id="c55fd-p101">This article refers to code samples for interacting with Azure Active Directory Graph. You can download the code samples  [here](https://1drv.ms/u/s!AuAlJmH2xI6Kg3ItzF78krMFxJu3).</span></span></p>
</blockquote>

<span data-ttu-id="c55fd-p102">SharePoint Server 2016 offre la possibilité d’authentifier les utilisateurs à l’aide de l’authentification basée sur les revendications, ce qui vous permet de gérer vos utilisateurs en les authentifiant avec différents fournisseurs d’identité que vous faites confiance, mais une autre personne gère. Par exemple, au lieu de gérer l’authentification des utilisateurs par le biais de Services de domaine Active Directory (AD DS), vous pouvez activer les utilisateurs s’authentifient à l’aide d’Azure Active Directory (AD Azure). Cela permet l’authentification des utilisateurs de nuage uniquement avec le suffixe onmicrosoft.com dans leur nom d’utilisateur, les utilisateurs synchronisé avec un répertoire local et a invité les utilisateurs invités à partir d’autres annuaires. Il vous permet également de tirer parti des fonctionnalités AD Azure telles que l’authentification à facteurs multiples et des fonctionnalités avancées de création de rapports.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p102">SharePoint Server 2016 provides the ability to authenticate users using claims-based authentication, making it easy to manage your users by authenticating them with different identity providers that you trust but someone else manages. For example, instead of managing user authentication through Active Directory Domain Services (AD DS), you could enable users to authenticate using Azure Active Directory (Azure AD). This enables authentication for cloud-only users with the onmicrosoft.com suffix in their username, users synchronized with an on-premises directory, and invited guest users from other directories. It also enables you to take advantage of Azure AD features such as multi-factor authentication and advanced reporting capabilities.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c55fd-p103">La solution décrite dans cet article peut également être utilisée avec SharePoint Server 2013 ; Cependant, souvenez-vous que SharePoint Server 2013 est proche de la fin du support standard. Pour plus d’informations, consultez la [Politique de Microsoft](https://support.microsoft.com/en-us/lifecycle/search?alpha=SharePoint%20Server%202013) et les [Mises à jour produit la stratégie de traitement pour SharePoint 2013](https://technet.microsoft.com/library/684173bb-e90a-4eb7-b268-b8d7458bc802(v=office.16).aspx).</span><span class="sxs-lookup"><span data-stu-id="c55fd-p103">The solution described in this article can also be used with SharePoint Server 2013; however, keep in mind that SharePoint Server 2013 is nearing the end of mainstream support. For more information, see [Microsoft Lifecycle Policy](https://support.microsoft.com/en-us/lifecycle/search?alpha=SharePoint%20Server%202013) and [Updated Product Servicing Policy for SharePoint 2013](https://technet.microsoft.com/library/684173bb-e90a-4eb7-b268-b8d7458bc802(v=office.16).aspx).</span></span>

<span data-ttu-id="c55fd-p104">Cet article explique comment vous pouvez utiliser AD Azure pour authentifier les utilisateurs au lieu de vos locaux sur les services AD DS. Dans cette configuration, AD Azure devient un fournisseur d’identité approuvé pour 2016 du serveur SharePoint. Cette configuration ajoute une méthode d’authentification de l’utilisateur qui est distincte de l’authentification AD DS utilisée par l’installation de SharePoint Server 2016 lui-même. Pour bénéficier de cet article, vous devez être familiarisé avec WS-Federation. Pour plus d’informations, consultez [Présentation de WS-Federation](https://go.microsoft.com/fwlink/p/?linkid=188052).</span><span class="sxs-lookup"><span data-stu-id="c55fd-p104">This article explains how you can use Azure AD to authenticate your users instead of your on-premises AD DS. In this configuration, Azure AD becomes a trusted identity provider for SharePoint Server 2016. This configuration adds a user authentication method that is separate from the AD DS authentication used by the SharePoint Server 2016 installation itself. To benefit from this article, you should be familiar with WS-Federation. For more information, see [Understanding WS-Federation](https://go.microsoft.com/fwlink/p/?linkid=188052).</span></span>

![À l’aide d’Azure AD pour l’authentification de SharePoint](images/SAML11/fig1-architecture.png)

<span data-ttu-id="c55fd-p105">Auparavant, cette configuration aurait nécessité un service de fédération comme Azure Access Control Service (ACS) dans le nuage ou dans un environnement qui héberge les Services de fédération Active Directory (Active Directory Federation Services) transformer les jetons SAML 2.0 à la version 1.1 de SAML. Cette transformation n’est plus nécessaire car Azure annonce maintenant permet des jetons SAML 1.1 émettrices. Le schéma ci-dessus illustre le fonctionnement de l’authentification pour les utilisateurs de SharePoint 2016 dans cette configuration, montrant qu’il n’est plus une condition requise pour un rôle d’intermédiaire effectuer cette transformation.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p105">Previously, this configuration would have required a federation service such as Azure Access Control Service (ACS) in the cloud or an environment that hosts Active Directory Federation Services (AD FS) to transform tokens from SAML 2.0 to SAML 1.1. This transformation is no longer required as Azure AD now enables issuing SAML 1.1 tokens. The diagram above shows how authentication works for SharePoint 2016 users in this configuration, demonstrating that there is no longer a requirement for an intermediary to perform this transformation.</span></span>

> [!NOTE]
> <span data-ttu-id="c55fd-p106">Cette configuration fonctionne si la batterie de serveurs SharePoint est hébergé dans les ordinateurs virtuels Azure ou sur site. Il ne nécessite pas l’ouverture des ports de pare-feu supplémentaire à part garantir que les utilisateurs peut accéder à Azure Active Directory à partir de leur navigateur.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p106">This configuration works whether the SharePoint farm is hosted in Azure virtual machines or on-premises. It does not require opening additional firewall ports other than ensuring users can access Azure Active Directory from their browser.</span></span>

<span data-ttu-id="c55fd-125">Pour plus d’informations sur l’accessibilité de 2016 de SharePoint, consultez les [Directives d’accessibilité dans SharePoint Server 2016](https://go.microsoft.com/fwlink/p/?LinkId=393123).</span><span class="sxs-lookup"><span data-stu-id="c55fd-125">For information about SharePoint 2016 accessibility, see [Accessibility Guidelines in SharePoint Server 2016](https://go.microsoft.com/fwlink/p/?LinkId=393123).</span></span>

## <a name="configuration-overview"></a><span data-ttu-id="c55fd-126">Vue d’ensemble de la configuration</span><span class="sxs-lookup"><span data-stu-id="c55fd-126">Configuration overview</span></span>

<span data-ttu-id="c55fd-127">Suivez ces étapes générales pour configurer votre environnement pour utiliser AD Azure comme un fournisseur d’identité SharePoint Server 2016.</span><span class="sxs-lookup"><span data-stu-id="c55fd-127">Follow these general steps to set up your environment to use Azure AD as a SharePoint Server 2016 identity provider.</span></span>

1. <span data-ttu-id="c55fd-128">Créer un nouveau répertoire de publicité Azure ou utilisez votre répertoire existant.</span><span class="sxs-lookup"><span data-stu-id="c55fd-128">Create a new Azure AD directory or use your existing directory.</span></span>
2. <span data-ttu-id="c55fd-129">Assurez-vous que la zone de l’application web que vous souhaitez sécuriser avec Azure AD est configurée pour utiliser SSL.</span><span class="sxs-lookup"><span data-stu-id="c55fd-129">Ensure the zone for the web application that you want to secure with Azure AD is configured to use SSL.</span></span>
3. <span data-ttu-id="c55fd-130">Créez une nouvelle application d’entreprise dans Active Directory Azure.</span><span class="sxs-lookup"><span data-stu-id="c55fd-130">Create a new enterprise application in Azure AD.</span></span>
4. <span data-ttu-id="c55fd-131">Configurez un nouveau fournisseur d’identité approuvé dans SharePoint Server 2016.</span><span class="sxs-lookup"><span data-stu-id="c55fd-131">Configure a new trusted identity provider in SharePoint Server 2016.</span></span>
5. <span data-ttu-id="c55fd-132">Définissez les autorisations pour l’application web.</span><span class="sxs-lookup"><span data-stu-id="c55fd-132">Set the permissions for the web application.</span></span>
6. <span data-ttu-id="c55fd-133">Ajouter une stratégie d’émission de jeton SAML 1.1 dans Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c55fd-133">Add a SAML 1.1 token issuance policy in Azure AD.</span></span>
7. <span data-ttu-id="c55fd-134">Vérifiez le nouveau fournisseur.</span><span class="sxs-lookup"><span data-stu-id="c55fd-134">Verify the new provider.</span></span>

<span data-ttu-id="c55fd-135">Les sections suivantes décrivent comment effectuer ces tâches.</span><span class="sxs-lookup"><span data-stu-id="c55fd-135">The following sections describe how to perform these tasks.</span></span>

## <a name="step-1-create-a-new-azure-ad-directory-or-use-your-existing-directory"></a><span data-ttu-id="c55fd-136">Étape 1 : Créer un nouveau répertoire de publicité Azure ou utilisez votre répertoire existant</span><span class="sxs-lookup"><span data-stu-id="c55fd-136">Step 1: Create a new Azure AD directory or use your existing directory</span></span>

<span data-ttu-id="c55fd-p107">Dans le portail Azure ([https://portal.azure.com](https://portal.azure.com)), créez un nouveau répertoire. Fournir le nom de l’organisation, nom de domaine d’origine et le pays ou la région.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p107">In the Azure Portal ([https://portal.azure.com](https://portal.azure.com)), create a new directory. Provide the organization name, initial domain name, and the country or region.</span></span>

![Création d’un répertoire](images/SAML11/fig2-createdirectory.png) 

 <span data-ttu-id="c55fd-p108">Si vous avez déjà un répertoire tel que celui utilisé pour Microsoft Office 365 ou votre abonnement Microsoft Azure, vous pouvez utiliser ce répertoire à la place. Vous devez disposer des autorisations pour enregistrer les applications dans le répertoire.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p108">If you already have a directory such as the one used for Microsoft Office 365 or your Microsoft Azure subscription, you can use that directory instead. You must have permissions to register applications in the directory.</span></span>

## <a name="step-2-ensure-the-zone-for-the-web-application-that-you-want-to-secure-with-azure-ad-is-configured-to-use-ssl"></a><span data-ttu-id="c55fd-142">Étape 2 : Assurez-vous que la zone de l’application web que vous souhaitez sécuriser avec Azure AD est configurée pour utiliser SSL</span><span class="sxs-lookup"><span data-stu-id="c55fd-142">Step 2: Ensure the zone for the web application that you want to secure with Azure AD is configured to use SSL</span></span>

<span data-ttu-id="c55fd-p109">Cet article a été écrit à l’aide de l’architecture de référence dans la zone [exécuter une batterie de serveurs SharePoint Server 2016 dans Azure à haute disponibilité](https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/sharepoint). Les scripts accompagnant l’article utilisés pour déployer la solution décrite dans [cet article](https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/sharepoint) créent un site qui n’utilise pas SSL.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p109">This article was written using the reference architecture in [Run a high availability SharePoint Server 2016 farm in Azure](https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/sharepoint). The article’s accompanying scripts used to deploy the solution described in [this article](https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/sharepoint) create a site that does not use SSL.</span></span>  

<span data-ttu-id="c55fd-p110">À l’aide de SAML requiert l’application configurée pour utiliser SSL. Si votre application web de SharePoint n’est pas configurée pour utiliser SSL, procédez comme suit pour créer un nouveau certificat auto-signé pour configurer l’application web pour SSL. Cette configuration est destinée uniquement à un environnement de laboratoire et n’est pas destinée à être production. Environnements de production doivent utiliser un certificat signé.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p110">Using SAML requires the application be configured to use SSL. If your SharePoint web application is not configured to use SSL, use the following steps to create a new self-signed certificate to configure the web application for SSL. This configuration is only meant for a lab environment and is not intended for production. Production environments should use a signed certificate.</span></span>

1. <span data-ttu-id="c55fd-p111">Accédez à **l’Administration centrale** > **Gestion des applications** > **Gérer les Applications Web**et choisissez l’application web qui doit être étendu pour utiliser SSL. Sélectionnez l’application web et cliquez sur le bouton de **ruban de l’étendre** . Étendre l’application web pour utiliser la même URL, mais utiliser SSL avec le port 443.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p111">Go to **Central Administration** > **Application Management** > **Manage Web Applications**, and choose the web application that needs to be extended to use SSL. Select the web application and click the **Extend ribbon** button. Extend the web application to use the same URL but use SSL with port 443.</span></span></br><span data-ttu-id="c55fd-152">![Extension de l’application web vers un autre site IIS](images/SAML11/fig3-extendwebapptoiis.png)</span><span class="sxs-lookup"><span data-stu-id="c55fd-152">![Extending the web app to another IIS site](images/SAML11/fig3-extendwebapptoiis.png)</span></span></br>
2. <span data-ttu-id="c55fd-153">Dans le Gestionnaire des services Internet (IIS), double-cliquez sur **Certificats de serveur**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-153">In IIS Manager, double-click **Server Certificates**.</span></span>
3. <span data-ttu-id="c55fd-p112">Dans le volet **Actions** , cliquez sur **Créer un certificat auto-signé**. Tapez un nom convivial pour le certificat dans la spécifier un nom convivial pour la zone de certificat, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p112">In the **Actions** pane, click **Create Self-Signed Certificate**. Type a friendly name for the certificate in the Specify a friendly name for the certificate box, and then click **OK**.</span></span>
4. <span data-ttu-id="c55fd-156">À partir de la boîte de dialogue **Modifier la liaison de Site** , assurez-vous que le nom d’hôte est le même que le nom convivial, comme illustré dans l’image suivante.</span><span class="sxs-lookup"><span data-stu-id="c55fd-156">From the **Edit Site Binding** dialog box, ensure the host name is the same as the friendly name, as illustrated in the following image.</span></span></br><span data-ttu-id="c55fd-157">![Modification de la liaison de site dans IIS](images/SAML11/fig4-editsitebinding.png)</span><span class="sxs-lookup"><span data-stu-id="c55fd-157">![Editing site binding in IIS](images/SAML11/fig4-editsitebinding.png)</span></span></br>

<span data-ttu-id="c55fd-158">Chacun des serveurs web frontaux de la batterie de serveurs SharePoint nécessite la configuration du certificat pour la liaison de site dans IIS.</span><span class="sxs-lookup"><span data-stu-id="c55fd-158">Each of the web front end servers in the SharePoint farm will require configuring the certificate for the site binding in IIS.</span></span>


## <a name="step-3-create-a-new-enterprise-application-in-azure-ad"></a><span data-ttu-id="c55fd-159">Étape 3 : Créer une nouvelle application d’entreprise dans Active Directory Azure</span><span class="sxs-lookup"><span data-stu-id="c55fd-159">Step 3: Create a new enterprise application in Azure AD</span></span>

1. <span data-ttu-id="c55fd-p113">Dans le portail Azure ([https://portal.azure.com](https://portal.azure.com)), ouvrir votre répertoire AD Azure. **Les Applications d’entreprise**, puis cliquez sur **nouvelle application**. Choisissez **l’application Non-galerie**. Fournir un nom, comme *L’intégration SharePoint SAML* et cliquez sur **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p113">In the Azure Portal ([https://portal.azure.com](https://portal.azure.com)), open your Azure AD directory. Click **Enterprise Applications**, then click **New application**. Choose **Non-gallery application**. Provide a name such as *SharePoint SAML Integration* and click **Add**.</span></span></br><span data-ttu-id="c55fd-164">![Ajout d’une nouvelle application de bibliothèque non](images/SAML11/fig5-addnongalleryapp.png)</span><span class="sxs-lookup"><span data-stu-id="c55fd-164">![Adding a new non-gallery application](images/SAML11/fig5-addnongalleryapp.png)</span></span></br>
2. <span data-ttu-id="c55fd-p114">Cliquez sur le lien dans le volet de navigation pour configurer l’application ouverture de session unique. Remplacez la liste déroulante **Mode d’ouverture de session unique** **basée sur SAML session** pour afficher les propriétés de configuration de l’application SAML. Configurer les propriétés suivantes :</span><span class="sxs-lookup"><span data-stu-id="c55fd-p114">Click the Single sign-on link in the navigation pane to configure the application. Change the **Single Sign-on Mode** dropdown to **SAML-based Sign-on** to reveal the SAML configuration properties for the application. Configure with the following properties:</span></span></br>
    - <span data-ttu-id="c55fd-168">Identificateur :`urn:sharepoint:portal.contoso.local`</span><span class="sxs-lookup"><span data-stu-id="c55fd-168">Identifier: `urn:sharepoint:portal.contoso.local`</span></span>
    - <span data-ttu-id="c55fd-169">URL de la réponse :`https://portal.contoso.local/_trust/default.aspx`</span><span class="sxs-lookup"><span data-stu-id="c55fd-169">Reply URL: `https://portal.contoso.local/_trust/default.aspx`</span></span>
    - <span data-ttu-id="c55fd-170">URL de session :`https://portal.contoso.local/_trust/default.aspx`</span><span class="sxs-lookup"><span data-stu-id="c55fd-170">Sign-on URL: `https://portal.contoso.local/_trust/default.aspx`</span></span>
    - <span data-ttu-id="c55fd-171">Identificateur de l’utilisateur :`user.userprincipalname`</span><span class="sxs-lookup"><span data-stu-id="c55fd-171">User Identifier: `user.userprincipalname`</span></span></br>
    - <span data-ttu-id="c55fd-172">Remarque : N’oubliez pas de modifier les URL en remplaçant *portal.contoso.local* par l’URL du site SharePoint que vous souhaitez sécuriser.</span><span class="sxs-lookup"><span data-stu-id="c55fd-172">Note: Remember to change the URLs by replacing *portal.contoso.local* with the URL of the SharePoint site you want to secure.</span></span></br>
3. <span data-ttu-id="c55fd-173">Définir une table (semblable au tableau 1 ci-dessous) qui contient les lignes suivantes :</span><span class="sxs-lookup"><span data-stu-id="c55fd-173">Set up a table (similar to Table 1 below) that includes the following rows:</span></span></br> 
    - <span data-ttu-id="c55fd-174">Domaine</span><span class="sxs-lookup"><span data-stu-id="c55fd-174">Realm</span></span>
    - <span data-ttu-id="c55fd-175">Chemin d’accès complet au fichier de certificat de signature de SAML</span><span class="sxs-lookup"><span data-stu-id="c55fd-175">Full path to SAML signing certificate file</span></span>
    - <span data-ttu-id="c55fd-176">SAML Single Sign-On service URL (en remplaçant */saml2* par */wsfed*)</span><span class="sxs-lookup"><span data-stu-id="c55fd-176">SAML Single Sign-On service URL (replacing */saml2* with */wsfed*)</span></span>
    - <span data-ttu-id="c55fd-177">ID d’objet application.</span><span class="sxs-lookup"><span data-stu-id="c55fd-177">Application Object ID.</span></span> </br>
<span data-ttu-id="c55fd-178">Copiez la valeur de *l’identificateur* de la propriété *Realm* dans une table (voir tableau 1 ci-dessous.)</span><span class="sxs-lookup"><span data-stu-id="c55fd-178">Copy the *Identifier* value into the *Realm* property into a table  (See Table 1 below.)</span></span>
4. <span data-ttu-id="c55fd-179">Enregistrez vos modifications.</span><span class="sxs-lookup"><span data-stu-id="c55fd-179">Save your changes.</span></span>
5. <span data-ttu-id="c55fd-180">Cliquez sur le lien **configurer (nom de l’application)** pour accéder à la page de connexion configurer.</span><span class="sxs-lookup"><span data-stu-id="c55fd-180">Click the **Configure (app name)** link to access the Configure sign-on page.</span></span></br><span data-ttu-id="c55fd-181">![Configuration d’une connexion unique sur la page](images/SAML11/fig7-configssopage.png)</span><span class="sxs-lookup"><span data-stu-id="c55fd-181">![Configuring a single-sign on page](images/SAML11/fig7-configssopage.png)</span></span></br> 
    -  <span data-ttu-id="c55fd-p115">Cliquez sur le lien **SAML certificat de signature - brutes** pour télécharger le certificat de signature SAML sous la forme d’un fichier avec l’extension .cer. Copiez et collez le chemin d’accès complet au fichier téléchargé dans votre table.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p115">Click the **SAML Signing Certificate - Raw** link to download the SAML Signing Certificate as a file with the .cer extension. Copy and paste the full path to the downloaded file into your table.</span></span>
    - <span data-ttu-id="c55fd-184">Copiez et collez le lien SAML Sign-On Service URL unique dans votre remplacement de la partie */saml2* de l’URL avec */wsfed*.</span><span class="sxs-lookup"><span data-stu-id="c55fd-184">Copy and paste the SAML Single Sign-On Service URL link into your, replacing the */saml2* portion of the URL with */wsfed*.</span></span></br>
6.  <span data-ttu-id="c55fd-p116">Naviguez vers le volet des **Propriétés** de l’application. Copiez et collez la valeur de l’ID d’objet dans la table que vous définissez dans l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p116">Navigate to the **Properties** pane for the application. Copy and paste the Object ID value into the table you set up in Step 3.</span></span></br><span data-ttu-id="c55fd-187">![Volet des propriétés de l’application](images/SAML11/fig8-propertiespane.png)</span><span class="sxs-lookup"><span data-stu-id="c55fd-187">![Properties pane for the application](images/SAML11/fig8-propertiespane.png)</span></span></br>
7. <span data-ttu-id="c55fd-188">En utilisant les valeurs que vous avez capturé, assurez-vous que la table que vous définissez dans l’étape 3 ressemble au tableau 1 ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="c55fd-188">Using the values you captured, make sure the table you set up in Step 3 resembles Table 1 below.</span></span>


| <span data-ttu-id="c55fd-189">Tableau 1 : Les valeurs capturées</span><span class="sxs-lookup"><span data-stu-id="c55fd-189">Table 1: Values captured</span></span>  |  |
|---------|---------|
|<span data-ttu-id="c55fd-190">Domaine</span><span class="sxs-lookup"><span data-stu-id="c55fd-190">Realm</span></span> | `urn:sharepoint:portal.contoso.local` |
|<span data-ttu-id="c55fd-191">Chemin d’accès complet au fichier de certificat de signature de SAML</span><span class="sxs-lookup"><span data-stu-id="c55fd-191">Full path to SAML signing certificate file</span></span> | `C:/temp/SharePoint SAML Integration.cer`  |
|<span data-ttu-id="c55fd-192">URL du service d’authentification unique SAML (remplacez /saml2 par /wsfed) "</span><span class="sxs-lookup"><span data-stu-id="c55fd-192">SAML single sign-on service URL (replace /saml2 with /wsfed)</span></span> | `https://login.microsoftonline.com/b1726649-b616-460d-8d20-defab80d476c/wsfed` |
|<span data-ttu-id="c55fd-193">ID de l’objet application</span><span class="sxs-lookup"><span data-stu-id="c55fd-193">Application Object ID</span></span> | `a812f48b-d1e4-4c8e-93be-e4808c8ca3ac` |

> [!IMPORTANT]
> <span data-ttu-id="c55fd-p117">Remplacez la valeur de */saml2* dans l’URL */wsfed*. Le point de terminaison */saml2* traitera les jetons SAML 2.0. Le point de terminaison */wsfed* permet les jetons SAML 1.1 de traitement et est obligatoire pour la fédération de SharePoint 2016 SAML.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p117">Replace the */saml2* value in the URL with */wsfed*. The */saml2* endpoint will process SAML 2.0 tokens. The */wsfed* endpoint enables processing SAML 1.1 tokens and is required for SharePoint 2016 SAML federation.</span></span>

## <a name="step-4-configure-a-new-trusted-identity-provider-in-sharepoint-server-2016"></a><span data-ttu-id="c55fd-197">Étape 4 : Configurez un nouveau fournisseur d’identité approuvé dans SharePoint Server 2016</span><span class="sxs-lookup"><span data-stu-id="c55fd-197">Step 4: Configure a new trusted identity provider in SharePoint Server 2016</span></span>

<span data-ttu-id="c55fd-p118">Ouvrir une session sur le serveur SharePoint Server 2016 et ouvrir le Shell de gestion SharePoint 2016. Renseignez les valeurs de $realm, $wsfedurl et $filepath dans le tableau 1 et exécutez les commandes suivantes pour configurer un nouveau fournisseur d’identité approuvé.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p118">Sign into the SharePoint Server 2016 server and open the SharePoint 2016 Management Shell. Fill in the values of $realm, $wsfedurl, and $filepath from Table 1 and run the following commands to configure a new trusted identity provider.</span></span>

> [!TIP]
> <span data-ttu-id="c55fd-200">Si vous êtes novice dans l’utilisation de PowerShell ou que vous souhaitez en savoir plus sur la manière dont PowerShell fonctionne, consultez [SharePoint PowerShell](https://docs.microsoft.com/en-us/powershell/sharepoint/overview?view=sharepoint-ps).</span><span class="sxs-lookup"><span data-stu-id="c55fd-200">If you're new to using PowerShell or want to learn more about how PowerShell works, see [SharePoint PowerShell](https://docs.microsoft.com/en-us/powershell/sharepoint/overview?view=sharepoint-ps).</span></span> 

```
$realm = "<Realm from Table 1>"
$wsfedurl="<SAML single sign-on service URL from Table 1>"
$filepath="<Full path to SAML signing certificate file from Table 1>"
$cert = New-Object 
System.Security.Cryptography.X509Certificates.X509Certificate2($filepath)
New-SPTrustedRootAuthority -Name "AzureAD" -Certificate $cert
$map = New-SPClaimTypeMapping -IncomingClaimType "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name" -IncomingClaimTypeDisplayName "name" -LocalClaimType "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn"
$map2 = New-SPClaimTypeMapping -IncomingClaimType "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname" -IncomingClaimTypeDisplayName "GivenName" -SameAsIncoming
$map3 = New-SPClaimTypeMapping -IncomingClaimType "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname" -IncomingClaimTypeDisplayName "SurName" -SameAsIncoming
$ap = New-SPTrustedIdentityTokenIssuer -Name "AzureAD" -Description "SharePoint secured by Azure AD" -realm $realm -ImportTrustCertificate $cert -ClaimsMappings $map,$map2,$map3 -SignInUrl $wsfedurl -IdentifierClaim “http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name”
```

<span data-ttu-id="c55fd-201">Ensuite, procédez comme suit pour activer le fournisseur d’identité approuvé pour votre application :</span><span class="sxs-lookup"><span data-stu-id="c55fd-201">Next, follow these steps to enable the trusted identity provider for your application:</span></span>
1. <span data-ttu-id="c55fd-202">Dans l’Administration centrale, accédez à **Gérer les applications Web** et sélectionnez l’application web que vous souhaitez sécuriser avec AD Azure.</span><span class="sxs-lookup"><span data-stu-id="c55fd-202">In Central Administration, navigate to **Manage Web Application** and select the web application that you wish to secure with Azure AD.</span></span> 
2. <span data-ttu-id="c55fd-203">Dans le ruban, cliquez sur **Fournisseurs d’authentification** et cliquez sur la zone que vous souhaitez utiliser.</span><span class="sxs-lookup"><span data-stu-id="c55fd-203">In the ribbon, click **Authentication Providers** and choose the zone that you wish to use.</span></span>
3. <span data-ttu-id="c55fd-204">Sélectionnez le **fournisseur d’identité de confiance** et le fournisseur d’identité que vous venez d’enregistrer nommé *AzureAD*.</span><span class="sxs-lookup"><span data-stu-id="c55fd-204">Select **Trusted Identity provider** and select the identify provider you just registered named *AzureAD*.</span></span>  
4. <span data-ttu-id="c55fd-205">Le paramètre URL de la page de connexion, sélectionnez la **page de connexion personnalisée** et fournir la valeur « /_trust/ ».</span><span class="sxs-lookup"><span data-stu-id="c55fd-205">On the sign-in page URL setting, select **Custom sign in page** and provide the value “/_trust/”.</span></span> 
5. <span data-ttu-id="c55fd-206">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-206">Click **OK**.</span></span>

![Configuration de votre fournisseur d’authentification](images/SAML11/fig10-configauthprovider.png)

## <a name="step-5-set-the-permissions"></a><span data-ttu-id="c55fd-208">Étape 5 : Définir les autorisations</span><span class="sxs-lookup"><span data-stu-id="c55fd-208">Step 5: Set the permissions</span></span>

<span data-ttu-id="c55fd-209">Les utilisateurs qui seront AD Azure se connecter et accéder à SharePoint doivent accéder à l’application.</span><span class="sxs-lookup"><span data-stu-id="c55fd-209">The users who will log into Azure AD and access SharePoint must be granted access to the application.</span></span> 

1. <span data-ttu-id="c55fd-p119">Dans le portail d’Azure, ouvrez le répertoire de publicité Azure. **Les Applications d’entreprise**, puis cliquez sur **toutes les applications**. Cliquez sur l’application que vous avez créée précédemment (intégration de SAML SharePoint).</span><span class="sxs-lookup"><span data-stu-id="c55fd-p119">In the Azure Portal, open the Azure AD directory. Click **Enterprise Applications**, then click **All applications**. Click the application that you created previously (SharePoint SAML Integration).</span></span>
2. <span data-ttu-id="c55fd-213">Cliquez sur **utilisateurs et groupes**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-213">Click **Users and Groups**.</span></span> 
3. <span data-ttu-id="c55fd-214">Cliquez sur **Ajouter un utilisateur** pour ajouter un utilisateur ou un groupe qui dispose des autorisations pour se connecter à SharePoint à l’aide d’Active Directory Azure.</span><span class="sxs-lookup"><span data-stu-id="c55fd-214">Click **Add user** to add a user or group who will have permissions to log into SharePoint using Azure AD.</span></span>
4. <span data-ttu-id="c55fd-215">Sélectionnez l’utilisateur ou le groupe, puis cliquez sur **attribuer**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-215">Select the user or group then click **Assign**.</span></span>
 
<span data-ttu-id="c55fd-p120">L’utilisateur possède l’autorisation dans Active Directory Azure, mais aussi autorisation doit être accordée dans SharePoint. Utilisez les étapes suivantes pour définir des autorisations pour accéder à l’application web.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p120">The user has been granted permission in Azure AD, but also must be granted permission in SharePoint. Use the following steps to set the permissions to access the web application.</span></span>

1. <span data-ttu-id="c55fd-218">Dans l’Administration centrale, cliquez sur **Gestion des applications**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-218">In Central Administration, click **Application Management**.</span></span>
2. <span data-ttu-id="c55fd-219">Dans la section **Applications web** de la page **Gestion des applications**, cliquez sur **Gérer les applications web**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-219">On the **Application Management** page, in the **Web Applications** section, click **Manage web applications**.</span></span>
3. <span data-ttu-id="c55fd-220">Cliquez sur l'application web appropriée, puis sur **Stratégie de l'utilisateur**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-220">Click the appropriate web application, and then click **User Policy**.</span></span>
4. <span data-ttu-id="c55fd-221">Dans la stratégie d’Application Web, cliquez sur **Ajouter des utilisateurs**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-221">In Policy for Web Application, click **Add Users**.</span></span></br><span data-ttu-id="c55fd-222">![Recherche d’un utilisateur en revendication de nom](images/SAML11/fig11-searchbynameclaim.png)</span><span class="sxs-lookup"><span data-stu-id="c55fd-222">![Searching for a user by their name claim](images/SAML11/fig11-searchbynameclaim.png)</span></span></br>
5. <span data-ttu-id="c55fd-223">Dans la boîte de dialogue **Ajouter des utilisateurs**, cliquez sur la zone appropriée dans **Zones**, puis sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-223">In the **Add Users** dialog box, click the appropriate zone in **Zones**, and then click **Next**.</span></span>
6. <span data-ttu-id="c55fd-224">Dans la boîte de dialogue de **stratégie pour une Application Web** , dans la section **Sélectionner les utilisateurs** , cliquez sur l’icône **Parcourir** .</span><span class="sxs-lookup"><span data-stu-id="c55fd-224">In the **Policy for Web Application** dialog box, in the **Choose Users** section, click the **Browse** icon.</span></span>
7. <span data-ttu-id="c55fd-225">Dans la zone de texte **Rechercher** , tapez le nom de connexion d’un utilisateur dans le répertoire et cliquez sur **Rechercher**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-225">In the **Find** textbox, type the sign-in name for a user in your directory and click **Search**.</span></span> </br><span data-ttu-id="c55fd-226">Exemple : *demouser@blueskyabove.onmicrosoft.com*.</span><span class="sxs-lookup"><span data-stu-id="c55fd-226">Example: *demouser@blueskyabove.onmicrosoft.com*.</span></span>
8. <span data-ttu-id="c55fd-227">Sous l’en-tête AzureAD dans la liste, sélectionnez la propriété name et cliquez sur **Ajouter** , puis cliquez sur **OK** pour fermer la boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="c55fd-227">Under the AzureAD heading in the list view, select the name property and click **Add** then click **OK** to close the dialog.</span></span>
9. <span data-ttu-id="c55fd-228">Dans autorisations, cliquez sur **Contrôle total**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-228">In Permissions, click **Full Control**.</span></span></br><span data-ttu-id="c55fd-229">![L’autorisation de contrôle total à un utilisateur de revendications](images/SAML11/fig12-grantfullcontrol.png)</span><span class="sxs-lookup"><span data-stu-id="c55fd-229">![Granting full control to a claims user](images/SAML11/fig12-grantfullcontrol.png)</span></span></br>
10. <span data-ttu-id="c55fd-230">Cliquez sur **Terminer**, puis sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="c55fd-230">Click **Finish**, and then click **OK**.</span></span>

## <a name="step-6-add-a-saml-11-token-issuance-policy-in-azure-ad"></a><span data-ttu-id="c55fd-231">Étape 6 : Ajouter une stratégie d’émission de jeton SAML 1.1 dans Azure AD</span><span class="sxs-lookup"><span data-stu-id="c55fd-231">Step 6: Add a SAML 1.1 token issuance policy in Azure AD</span></span>

<span data-ttu-id="c55fd-p121">Lorsque l’application Azure AD est créée dans le portail, il utilise par défaut SAML 2.0. SharePoint Server 2016 requiert le format du jeton SAML 1.1. Le script suivant supprime la stratégie de SAML 2.0 par défaut et ajouter une nouvelle stratégie pour les jetons SAML 1.1 de problème.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p121">When the Azure AD application is created in the portal, it defaults to using SAML 2.0. SharePoint Server 2016 requires the SAML 1.1 token format. The following script will remove the default SAML 2.0 policy and add a new policy to issue SAML 1.1 tokens.</span></span>

```
Import-Module <file path of Initialize.ps1> 
$objectid = "<Application Object ID from Table 1>"
$saml2policyid = Get-PoliciesAssignedToServicePrincipal -servicePrincipalId $objectid | ?{$_.displayName -EQ "TokenIssuancePolicy"} | select objectId
Remove-PolicyFromServicePrincipal -policyId $saml2policyid -servicePrincipalId $objectid
$policy = Add-TokenIssuancePolicy -DisplayName SPSAML11 -SigningAlgorithm "http://www.w3.org/2001/04/xmldsig-more#rsa-sha256" -TokenResponseSigningPolicy TokenOnly -SamlTokenVersion "1.1"
Set-PolicyToServicePrincipal -policyId $policy.objectId -servicePrincipalId $objectid
```

## <a name="step-7-verify-the-new-provider"></a><span data-ttu-id="c55fd-235">Étape 7 : Vérifiez le nouveau fournisseur</span><span class="sxs-lookup"><span data-stu-id="c55fd-235">Step 7: Verify the new provider</span></span>

<span data-ttu-id="c55fd-p122">Ouvrez un navigateur vers l’URL de l’application web que vous avez configurés dans les étapes précédentes. Vous êtes redirigé vers la session dans Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p122">Open a browser to the URL of the web application that you configured in the previous steps. You are redirected to sign into Azure AD.</span></span>

![Signature dans Azure annonce configuré pour la fédération](images/SAML11/fig13-examplesignin.png)

<span data-ttu-id="c55fd-239">Vous êtes invité si vous souhaitez rester connecté.</span><span class="sxs-lookup"><span data-stu-id="c55fd-239">You are asked if you want to stay signed in.</span></span>

![Rester connecté ?](images/SAML11/fig14-staysignedin.png)

<span data-ttu-id="c55fd-241">Enfin, vous pouvez accéder au site connecté en tant qu’un utilisateur à partir de votre client Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c55fd-241">Finally, you can access the site logged in as a user from your Azure Active Directory tenant.</span></span>

![Utilisateur connecté à SharePoint](images/SAML11/fig15-signedinsharepoint.png)


## <a name="additional-resources"></a><span data-ttu-id="c55fd-243">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="c55fd-243">Additional resources</span></span>

[<span data-ttu-id="c55fd-244">Présentation de WS-Federation</span><span class="sxs-lookup"><span data-stu-id="c55fd-244">Understanding WS-Federation</span></span>](https://go.microsoft.com/fwlink/p/?linkid=188052)
  
[<span data-ttu-id="c55fd-245">Adoption du cloud et solutions hybrides</span><span class="sxs-lookup"><span data-stu-id="c55fd-245">Cloud adoption and hybrid solutions</span></span>](cloud-adoption-and-hybrid-solutions.md)
  
## <a name="join-the-discussion"></a><span data-ttu-id="c55fd-246">Participer à la discussion</span><span class="sxs-lookup"><span data-stu-id="c55fd-246">Join the discussion</span></span>

|<span data-ttu-id="c55fd-247">**Contactez-nous**</span><span class="sxs-lookup"><span data-stu-id="c55fd-247">**Contact us**</span></span>|<span data-ttu-id="c55fd-248">**Description**</span><span class="sxs-lookup"><span data-stu-id="c55fd-248">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="c55fd-249">**De quelles solutions avez-vous besoin ?**</span><span class="sxs-lookup"><span data-stu-id="c55fd-249">**What cloud adoption content do you need?**</span></span> <br/> |<span data-ttu-id="c55fd-p123">Nous sommes en train de créer du contenu pour les solutions qui s'étendent sur plusieurs produits et services Microsoft. Donnez-nous votre avis sur nos solutions entre serveurs ou demandez des solutions spécifiques en envoyant un courrier électronique à [MODAcontent@microsoft.com](mailto:cloudadopt@microsoft.com?Subject=[Cloud%20Adoption%20Content%20Feedback]:%20).</span><span class="sxs-lookup"><span data-stu-id="c55fd-p123">We are creating content for cloud adoption that spans multiple Microsoft cloud platforms and services. Let us know what you think about our cloud adoption content, or ask for specific content by sending email to [cloudadopt@microsoft.com](mailto:cloudadopt@microsoft.com?Subject=[Cloud%20Adoption%20Content%20Feedback]:%20).  </span></span><br/> |
|<span data-ttu-id="c55fd-252">**Participer à la discussion sur les solutions**</span><span class="sxs-lookup"><span data-stu-id="c55fd-252">**Join the cloud adoption discussion**</span></span> <br/> |<span data-ttu-id="c55fd-p124">Si vous êtes passionné par les solutions basées sur le cloud, rejoignez le conseil consultatif de l’adoption cloud (CAAB) pour interagir avec une communauté vaste et dynamique de développeurs de contenu Microsoft, de professionnels du secteur et de clients venant du monde entier. Pour participer, ajoutez-vous en tant que membre de l’espace [CAAB (Conseil consultatif de l’adoption cloud)](https://aka.ms/caab) de la communauté Microsoft Tech et envoyez-nous un message électronique à l’adresse [CAAB@microsoft.com](mailto:caab@microsoft.com?Subject=I%20just%20joined%20the%20Cloud%20Adoption%20Advisory%20Board!). Tout le monde peut lire le contenu lié à la communauté sur le [blog CAAB](https://blogs.technet.com/b/solutions_advisory_board/). Toutefois, les membres CAAB reçoivent des invitations à des webinaires privés qui décrivent les nouvelles solutions et ressources relatives à l’adoption cloud.</span><span class="sxs-lookup"><span data-stu-id="c55fd-p124">If you are passionate about cloud-based solutions, consider joining the Cloud Adoption Advisory Board (CAAB) to connect with a larger, vibrant community of Microsoft content developers, industry professionals, and customers from around the globe. To join, add yourself as a member of the [CAAB (Cloud Adoption Advisory Board) space](https://aka.ms/caab) of the Microsoft Tech Community and send us a quick email at [CAAB@microsoft.com](mailto:caab@microsoft.com?Subject=I%20just%20joined%20the%20Cloud%20Adoption%20Advisory%20Board!). Anyone can read community-related content on the [CAAB blog](https://blogs.technet.com/b/solutions_advisory_board/). However, CAAB members get invitations to private webinars that describe new cloud adoption resources and solutions.  </span></span><br/> |
|<span data-ttu-id="c55fd-256">**Obtenir l'image que vous voyez ici**</span><span class="sxs-lookup"><span data-stu-id="c55fd-256">**Get the art you see here**</span></span> <br/> |<span data-ttu-id="c55fd-p125">Si vous voulez obtenir une copie modifiable de l’image que vous voyez dans cet article, nous serons ravis de vous l’envoyer. Envoyez-nous votre demande par courrier électronique, en incluant l’URL et le titre de l’illustration, à [cloudadopt@microsoft.com](mailto:cloudadopt@microsoft.com?subject=[Art%20Request]:%20).</span><span class="sxs-lookup"><span data-stu-id="c55fd-p125">If you want an editable copy of the art you see in this article, we'll be glad to send it to you. Email your request, including the URL and title of the art, to [cloudadopt@microsoft.com](mailto:cloudadopt@microsoft.com?subject=[Art%20Request]:%20).  </span></span><br/> |
   

